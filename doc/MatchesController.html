<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: MatchesController
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "MatchesController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (M)</a> &raquo;
    
    
    <span class="title">MatchesController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: MatchesController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">MatchesController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/matches_controller.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Controller for managing match records for the authenticated user.</p>

<p>Handles listing matches, creating new ones, and updating existing ones, while managing the userâ€™s active World Cup progress.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>  &#x21d2; JSON </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST /matches.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">#<strong>index</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /matches.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>  &#x21d2; JSON </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>PUT /matches/:id.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create-instance_method">
  
    #<strong>create</strong>  &#x21d2; <tt>JSON</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST /matches</p>

<p>Creates a new match for the current user and associates it with the active World Cup. If there is no active World Cup, one is created automatically. The logic updates the World Cup progress depending on match results.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>success or error messages for frontend consumption.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/matches_controller.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='ivar'>@match</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Match.html" title="Match (class)">Match</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_match_params'>match_params</span><span class='rparen'>)</span>
  <span class='ivar'>@match</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span>

  <span class='id identifier rubyid_active_world_cup'>active_world_cup</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_world_cups'>world_cups</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>is_active:</span> <span class='kw'>true</span><span class='rparen'>)</span>

  <span class='comment'># If there is no active World Cup, create one
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span>
    <span class='id identifier rubyid_active_world_cup'>active_world_cup</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_world_cups'>world_cups</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span>
      <span class='label'>current_stage:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Group Stage</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>matches_won:</span> <span class='int'>0</span><span class='comma'>,</span>
      <span class='label'>matches_lost:</span> <span class='int'>0</span><span class='comma'>,</span>
      <span class='label'>was_won:</span> <span class='kw'>false</span><span class='comma'>,</span>
      <span class='label'>is_active:</span> <span class='kw'>true</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@match</span><span class='period'>.</span><span class='id identifier rubyid_world_cup'>world_cup</span> <span class='op'>=</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span>

  <span class='kw'>if</span> <span class='ivar'>@match</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
    <span class='comment'># Handle win case and update World Cup progress
</span>    <span class='kw'>if</span> <span class='ivar'>@match</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Win</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches_won'>matches_won</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches_won'>matches_won</span> <span class='op'>==</span> <span class='int'>2</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_current_stage'>current_stage</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Round of 16</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches_won'>matches_won</span> <span class='op'>==</span> <span class='int'>3</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_current_stage'>current_stage</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Quarter Finals</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches_won'>matches_won</span> <span class='op'>==</span> <span class='int'>4</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_current_stage'>current_stage</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Semi Finals</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches_won'>matches_won</span> <span class='op'>==</span> <span class='int'>5</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_current_stage'>current_stage</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Final</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches_won'>matches_won</span> <span class='op'>==</span> <span class='int'>6</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_was_won'>was_won</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_is_active'>is_active</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='comment'># Handle loss case and potential World Cup deactivation
</span>      <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches_lost'>matches_lost</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_current_stage'>current_stage</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Group Stage</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_is_active'>is_active</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_was_won'>was_won</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches_lost'>matches_lost</span> <span class='op'>&gt;=</span> <span class='int'>2</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_matches'>matches</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;=</span> <span class='int'>3</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_is_active'>is_active</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_was_won'>was_won</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_active_world_cup'>active_world_cup</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>

    <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span> <span class='label'>success:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>redirect_url:</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_referer'>referer</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span> <span class='label'>success:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>errors:</span> <span class='ivar'>@match</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    #<strong>index</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>GET /matches</p>

<p>Loads all matches belonging to the currently logged-in user.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


14
15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/matches_controller.rb', line 14</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span>
  <span class='ivar'>@matches</span> <span class='op'>=</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_matches'>matches</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    #<strong>update</strong>  &#x21d2; <tt>JSON</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>PUT /matches/:id</p>

<p>Updates an existing match with new values.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>success or error messages.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/matches_controller.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='ivar'>@match</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Match.html" title="Match (class)">Match</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='ivar'>@match</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_match_params'>match_params</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span> <span class='label'>success:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>redirect_url:</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_referer'>referer</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span> <span class='label'>success:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>errors:</span> <span class='ivar'>@match</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Jul 27 00:06:57 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.4).
</div>

    </div>
  </body>
</html>